<h2>販売情報過去データ検索</h2>

<div class="search-box">
  <label>得意先コード:
    <input type="text" [(ngModel)]="params.customerCode">
  </label>

  <label>得意先名:
    <input type="text" [(ngModel)]="params.customerName">
  </label>

  <label>検索カナ名:
    <input type="text" [(ngModel)]="params.customerKana">
  </label>

  <label>商品名:
    <input type="text" [(ngModel)]="params.productName">
  </label>

  <label>商品コード:
    <input type="text" [(ngModel)]="params.productCode">
  </label>

  <label>検索範囲指定</label>
  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; margin-top: 20px;">
    <label>開始日:
      <input type="date" [(ngModel)]="params.startDate">
    </label>
    <span>～</span>
    <label>終了日:
      <input type="date" [(ngModel)]="params.endDate">
    </label>
  </div>
  
  <div style="margin-bottom: 10px; gap: 10px; display: flex; margin-bottom: 30px;">
    <button (click)="setThisMonth()">今月</button>
    <button (click)="setLastMonth()">先月</button>
    <button (click)="setLast30Days()">過去30日</button>
  </div>
  
  <button (click)="doSearch()">検索</button>
</div>

<hr>

@if (loading) {
  <p>検索中...</p>
}

@if (results.length === 0 && !loading) {
  <p>該当するデータはありません。</p>
}

/* ✅ 件数表示 */
@if (!loading && total > 0) {
  <div style="margin: 10px 0; font-weight: bold;">
    全 {{ total }} 件中
    {{ startIndex }} 〜 {{ endIndex }} 件表示
  </div>
}

/* ✅ ページナビ */
@if (total > pageSize) {
  <div style="margin-bottom: 15px;">
    <button (click)="prevPage()" [disabled]="page === 1">前へ</button>

    @for (p of pages; track p) {
      <button
        (click)="goPage(p)"
        [style.fontWeight]="p === page ? 'bold' : 'normal'">
        {{ p }}
      </button>
    }

    <button (click)="nextPage()" [disabled]="page >= totalPages">次へ</button>
  </div>
}

@if (results.length > 0) {
  <table class="result-table">
    <thead>
      <tr>
        <th>日付</th>
        <th>得意先名</th>
        <th>カナ名</th>
        <th>商品名</th>
        <th>商品コード</th>
        <th>数量</th>
        <th>単位名</th>
        <th>金額</th>
      </tr>
    </thead>

    <tbody>
      @for (item of results; track item) {
        <tr>
          <td>{{ item.sale_date }}</td>
          <td>{{ item.customer_name }}</td>
          <td>{{ item.customer_kana }}</td>
          <td>{{ item.product_name }}</td>
          <td>{{ item.product_code }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.unit_name }}</td>
          <td>{{ item.amount }}</td>
        </tr>
      }
    </tbody>
  </table>
}
